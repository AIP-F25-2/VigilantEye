from marshmallow import Schema, fields, validate

class DeviceSchema(Schema):
    """Device schema for serialization"""
    id = fields.Integer(dump_only=True)
    device_id = fields.String(dump_only=True)
    name = fields.String(dump_only=True)
    device_type = fields.String(dump_only=True)
    status = fields.String(dump_only=True)
    is_default = fields.Boolean(dump_only=True)
    driver = fields.String(dump_only=True)
    capabilities = fields.Dict(dump_only=True)
    supported_formats = fields.List(fields.String(), dump_only=True)
    supported_resolutions = fields.List(fields.String(), dump_only=True)
    supported_framerates = fields.List(fields.Integer(), dump_only=True)
    connection_string = fields.String(dump_only=True)
    rtsp_url = fields.String(dump_only=True)
    ip_address = fields.String(dump_only=True)
    port = fields.Integer(dump_only=True)
    manufacturer = fields.String(dump_only=True)
    model = fields.String(dump_only=True)
    version = fields.String(dump_only=True)
    serial_number = fields.String(dump_only=True)
    last_used_at = fields.DateTime(dump_only=True)
    usage_count = fields.Integer(dump_only=True)
    total_recording_time = fields.Float(dump_only=True)
    default_settings = fields.Dict(dump_only=True)
    current_settings = fields.Dict(dump_only=True)
    last_error = fields.String(dump_only=True)
    error_count = fields.Integer(dump_only=True)
    last_error_at = fields.DateTime(dump_only=True)
    user_id = fields.Integer(dump_only=True)
    created_at = fields.DateTime(dump_only=True)
    updated_at = fields.DateTime(dump_only=True)

class DeviceCreateSchema(Schema):
    """Schema for creating devices"""
    device_id = fields.String(required=True, validate=validate.Length(min=1, max=100))
    name = fields.String(required=True, validate=validate.Length(min=1, max=255))
    device_type = fields.String(required=True, validate=validate.OneOf(['webcam', 'screen', 'rtsp', 'audio', 'file']))
    driver = fields.String(allow_none=True, validate=validate.Length(max=100))
    connection_string = fields.String(allow_none=True, validate=validate.Length(max=500))
    rtsp_url = fields.String(allow_none=True, validate=validate.Length(max=500))
    ip_address = fields.String(allow_none=True, validate=validate.Length(max=45))
    port = fields.Integer(allow_none=True, validate=validate.Range(min=1, max=65535))
    manufacturer = fields.String(allow_none=True, validate=validate.Length(max=100))
    model = fields.String(allow_none=True, validate=validate.Length(max=100))
    version = fields.String(allow_none=True, validate=validate.Length(max=50))
    serial_number = fields.String(allow_none=True, validate=validate.Length(max=100))
    default_settings = fields.Dict(allow_none=True)
    current_settings = fields.Dict(allow_none=True)
